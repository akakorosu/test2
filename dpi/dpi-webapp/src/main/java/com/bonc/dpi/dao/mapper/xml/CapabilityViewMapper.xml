<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bonc.dpi.dao.mapper.CapabilityViewMapper">
<!--  	<resultMap id="resultMap" type="com.bonc.dpi.dao.entity.IndustryOverview"> -->
<!-- 		<result column="month_id" jdbcType="VARCHAR" property="monthId" /> -->
<!-- 		<result column="city_id" jdbcType="VARCHAR" property="cityId" /> -->
<!-- 		<result column="area_id" jdbcType="VARCHAR" property="areaId" /> -->
<!-- 		<result column="prod_id" jdbcType="VARCHAR" property="prodId" /> -->
<!-- 		<result column="prod_name" jdbcType="VARCHAR" property="prodName" /> -->
<!-- 		<result column="prod_type" jdbcType="VARCHAR" property="prodType" /> -->
<!-- 		<result column="prod_type_name" jdbcType="VARCHAR" property="prodTypeName" /> -->
<!-- 		<result column="label_id1" jdbcType="VARCHAR" property="labelId1" /> -->
<!-- 		<result column="label_name1" jdbcType="VARCHAR" property="labelName1" /> -->
<!-- 		<result column="label_id2" jdbcType="VARCHAR" property="labelId2" /> -->
<!-- 		<result column="label_name2" jdbcType="VARCHAR" property="labelName2" /> -->
<!-- 		<result column="sex" jdbcType="VARCHAR" property="sex" /> -->
<!-- 		<result column="age" jdbcType="VARCHAR" property="age" /> -->
<!-- 		<result column="user_total" jdbcType="DECIMAL" property="userTotal" /> -->
<!-- 		<result column="user_count" jdbcType="DECIMAL" property="userCount" /> -->
<!-- 		<result column="flow" jdbcType="DECIMAL" property="flow" /> -->
<!-- 		<result column="all_user_total" jdbcType="DECIMAL" property="allUserTotal" /> -->
<!-- 		<result column="all_user_count" jdbcType="DECIMAL" property="allUserCount" /> -->
<!-- 		<result column="all_flow" jdbcType="DECIMAL" property="allFlow" /> -->
<!-- 		<result column="label_name" jdbcType="VARCHAR" property="labelName" /> -->
<!-- 		<result column="hour_id" jdbcType="VARCHAR" property="hourId" /> -->
<!-- 		<result column="city_id" jdbcType="DECIMAL" property="city" /> -->
<!-- 		<result column="area_id" jdbcType="VARCHAR" property="area" /> -->
<!-- 		<result column="percentUser" jdbcType="VARCHAR" property="percentUser" /> -->
<!-- 	</resultMap> -->
	<!-- 分类数据 -->
	
	<select id="getLabelNum"  resultType="java.util.HashMap"  databaseId="mysql">
		select count(*) allNum,count(case when m.LABEL_CODE2 is not null and  LABEL_CODE2!='' then 1 end) twoNum from dim_ia_product_label m
	</select>
	<select id="getAllAct"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		select chinesename chineseName, foreignname  foreignName from DM_D_DIRECTOR_INFO
	</select>
	<select id="getAllLabelIn"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		select content_label_code1 contentLabelCode1, content_label_name1 contentLabelName1,
        content_label_code2 contentLabelCode2, content_label_name2 contentLabelName2,
        content_label_code3 contentLabelCode3, content_label_name3 contentLabelName3,
        content_label_code4 contentLabelCode4, content_label_name4 contentLabelName4,
        content_label_code5 contentLabelCode5, content_label_name5 contentLabelName5,
        content_label_code6 contentLabelCode6, content_label_name6 contentLabelName6
        from dim_ia_content_label where content_label_code1=#{code}
	</select>
	<select id="selectList"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		select chinesename chineseName, foreignname foreignName,year year,work_name workName,duty duty,type type from DM_D_DIRECTOR_WORKS
		where 1=1
		<if test="foreignName != null and foreignName != ''">
			and foreignname = #{foreignName}
			
		</if>
		order by year desc
	</select>
	<select id="getLabelNum"  resultType="java.util.HashMap"  databaseId="oracle">
		select count(*) allNum,count(case when m.LABEL_CODE2 is not null  then 1 end) twoNum from dim_ia_product_label m
	</select>
	
	<select id="getLabelLvl1"  resultType="String"  >
		SELECT LABEL_NAME from dim_ia_product_label GROUP BY dim_ia_product_label.LABEL_NAME order by dim_ia_product_label.LABEL_NAME
	</select>
	<select id="getModelWorkLvl1"  resultType="String"  >
		select prof_name1  from dim_ia_user_prof
	</select>
	<select id="getModelInfo"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		SELECT lvl1 lvl1,lvl2 lvl2,model_name as modelName,model_info as modelInfo from dim_ia_model_detail where lvl1=#{type}
	</select>
	<select id="getLoadProd"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		select prod_name prodName ,prod_label_code prodLabelCode from dim_ia_product_info 
	</select>
	<select id="getLabelLvl2"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		SELECT label_name labelName,label_name1 labelName1,label_code1 labelCode1 
	    from dim_ia_product_label where label_name=#{type} group by label_name,label_name1,label_code1
	</select>
	<select id="getWorkLvl2"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		select prof_name1 profName1,prof_name2 profName2,bak bak from dim_ia_user_prof where prof_name1=#{type}
	</select>
	<select id="getChild"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		select  age_sch childSch ,bak bak from dim_ia_user_age
	</select>
	<select id="getLabelLvl3"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
		SELECT label_name2 labelName2,label_code2 labelCode2
	    from dim_ia_product_label where label_name=#{type} and label_name1=#{type2} 
	</select>
<!-- 	<select id="getLabelLvl3"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  databaseId="oracle"> -->
<!-- 		select CONTENT_LABEL_CODE1,count(*) allNum, -->
<!--         count(case when (m.CONTENT_LABEL_CODE2 is not null ) and ( CONTENT_LABEL_CODE3 is null  ) then 1 end) oneNum, -->
<!--         count(case when (m.CONTENT_LABEL_CODE3 is not null ) and ( CONTENT_LABEL_CODE4 is null  ) then 1 end) twoNum, -->
<!--         count(case when (m.CONTENT_LABEL_CODE4 is not null ) and ( CONTENT_LABEL_CODE5 is null ) then 1 end) threeNum, -->
<!--         count(case when (m.CONTENT_LABEL_CODE5 is not null ) and ( CONTENT_LABEL_CODE6 is null ) then 1 end) fourNum, -->
<!--         count(case when (m.CONTENT_LABEL_CODE6 is not null )  then 1 end) fiveNum -->
<!--         from dim_ia_content_label m GROUP BY CONTENT_LABEL_CODE1  -->
<!-- 	</select> -->
	<select id="getContentKuLabel"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  databaseId="oracle">
		select CONTENT_LABEL_CODE1 contentLabelCode1,count(*) allNum,
        count(case when (m.CONTENT_LABEL_CODE2 is not null ) and ( CONTENT_LABEL_CODE3 is null  ) then 1 end) oneNum,
        count(case when (m.CONTENT_LABEL_CODE3 is not null ) and ( CONTENT_LABEL_CODE4 is null  ) then 1 end) twoNum,
        count(case when (m.CONTENT_LABEL_CODE4 is not null ) and ( CONTENT_LABEL_CODE5 is null ) then 1 end) threeNum,
        count(case when (m.CONTENT_LABEL_CODE5 is not null ) and ( CONTENT_LABEL_CODE6 is null ) then 1 end) fourNum,
        count(case when (m.CONTENT_LABEL_CODE6 is not null )  then 1 end) fiveNum
        from dim_ia_content_label m GROUP BY CONTENT_LABEL_CODE1 
	</select>
	<select id="getContentKuLabel"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  databaseId="mysql">
		select CONTENT_LABEL_CODE1 contentLabelCode1,count(case when (m.CONTENT_LABEL_CODE1 is not null and m.CONTENT_LABEL_CODE1!='')  then 1 end) allNum,
        count(case when (m.CONTENT_LABEL_CODE2 is not null and m.CONTENT_LABEL_CODE2!='') and ( CONTENT_LABEL_CODE3 is null or CONTENT_LABEL_CODE3='') then 1 end) oneNum,
        count(case when (m.CONTENT_LABEL_CODE3 is not null and m.CONTENT_LABEL_CODE3!='') and ( CONTENT_LABEL_CODE4 is null or CONTENT_LABEL_CODE4='' ) then 1 end) twoNum,
        count(case when (m.CONTENT_LABEL_CODE4 is not null and m.CONTENT_LABEL_CODE4!='') and ( CONTENT_LABEL_CODE5 is null or CONTENT_LABEL_CODE5='') then 1 end) threeNum,
        count(case when (m.CONTENT_LABEL_CODE5 is not null and m.CONTENT_LABEL_CODE5!='') and ( CONTENT_LABEL_CODE6 is null or CONTENT_LABEL_CODE6='') then 1 end) fourNum,
        count(case when (m.CONTENT_LABEL_CODE6 is not null and m.CONTENT_LABEL_CODE6!='')  then 1 end) fiveNum
       from dim_ia_content_label m GROUP BY CONTENT_LABEL_CODE1 
	</select>
	<select id="getContentKuProdName"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  databaseId="mysql">
		SELECT prod_name prodName from dim_ia_product_info,(select DISTINCT prod_id from 
        dim_ia_keyword_search_rule where dim_ia_keyword_search_rule.GROUP_TYPE=#{groupType}) a
        where dim_ia_product_info.PROD_ID=a.prod_id LIMIT 7
	</select>
	<select id="getContentKuProdName"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  databaseId="oracle">
<!-- 		SELECT prod_name prodName from dim_ia_product_info,(select DISTINCT prod_id from  -->
<!--         dim_ia_keyword_search_rule where dim_ia_keyword_search_rule.GROUP_TYPE=#{groupType}) a -->
<!--         where dim_ia_product_info.PROD_ID=a.prod_id  -->
        
        
        SELECT * FROM  
        (  
        SELECT A.*, ROWNUM RN  
        FROM (SELECT prod_name prodName from dim_ia_product_info,(select DISTINCT prod_id from 
        dim_ia_keyword_search_rule where dim_ia_keyword_search_rule.GROUP_TYPE=#{groupType}) a
        where dim_ia_product_info.PROD_ID=a.prod_id ) A  
        WHERE ROWNUM  &lt;= 7  
         )  
       WHERE RN &gt;= 0  
	</select>
	<select id="getContentKuAttr"  resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
	   select  content_type contentType ,value value from dim_ia_capability_attr where content_type=#{contentType}
	
	</select>
	
	<select id="getLabelProd"  parameterType="com.bonc.dpi.dao.entity.CapabilityView" resultType="com.bonc.dpi.dao.entity.CapabilityView"  >
	  SELECT prod_name prodName from dim_ia_product_info where 1=1 
	    
	    <if test="labelCode1 != null and labelCode1 != ''">
			and prod_label_code like #{labelCode1}
			
		</if>
		<if test="labelCode2 != null and labelCode2 != ''">
			and prod_label_code like #{labelCode2}
			
		</if>
		<if test="prodName != null and prodName != ''">
			and prod_name like #{prodName}
			
		</if>
	</select>
	<select id="updateAct"  parameterType="com.bonc.dpi.dao.entity.CapabilityView"   >
	 update DM_D_DIRECTOR_INFO set foreignname=#{foreignName} where chinesename=#{chineseName}
	    
	   
	</select>
	
	<select id="getListByPage"  parameterType="com.bonc.dpi.dao.entity.CapabilityView"  resultType="com.bonc.dpi.dao.entity.CapabilityView" databaseId="mysql">
	    select  * from dim_ia_content_label ORDER BY id  LIMIT #{startNum},#{pageSize}
	    
	   
	</select>
	<select id="getListByPage"  parameterType="com.bonc.dpi.dao.entity.CapabilityView"  resultType="com.bonc.dpi.dao.entity.CapabilityView" databaseId="oracle">
	     SELECT * FROM (SELECT t.*, ROWNUM AS rowno FROM (select chinesename chineseName ,foreignname foreignName from DM_D_DIRECTOR_INFO where 1=1
	     
	     <if test="gender != null and gender != ''">
			and gender = #{gender}
			
		 </if>
		 <if test="district != null and district != ''">
			and district = #{district}
			
		 </if>
		 order by chineseName
	     
	     ) t ) WHERE rowno &gt;= #{startNum} AND rowno &lt;= #{endNum}
	    
	   
	</select>
	<select id="countAllDir"  parameterType="com.bonc.dpi.dao.entity.CapabilityView"  resultType="java.lang.Integer" >
      select count(*) from DM_D_DIRECTOR_INFO where 1=1
         <if test="gender != null and gender != ''">
			and gender = #{gender}
			
		 </if>
		 <if test="district != null and district != ''">
			and district = #{district}
			
		 </if>
	    
	   
	</select>
	<select id="getDireDetail"  parameterType="com.bonc.dpi.dao.entity.CapabilityView"  resultType="com.bonc.dpi.dao.entity.CapabilityView" >
	    select  chinesename chineseName ,foreignname foreignName ,ANOTHERNAME  anotherName 
	    ,NATIONALITY  nationality,NATION nation,CONSTELLATION constellation,BLOODTYPE bloodType
	    ,HEIGHT height, weight weight,BIRTHPALCE brithPalce, BIRTH birth, NATIVEPLACE nativePlace
	    ,JOB job,GENDER gender
	     from DM_D_DIRECTOR_INFO  where foreignname=#{foreignName}
	</select>
	
	<select id="getProductFbDescInfo"  parameterType="com.bonc.dpi.dao.entity.ProductFbDescInfo"  resultType="com.bonc.dpi.dao.entity.ProductFbDescInfo" >
		SELECT a.prod_id  prodId,
		       p.prod_name prodName,
		       a.prod_label_code prodLabelCode,
		       b.JOIN_LABEL_NAME joinLabelName,
		       t.label_desc labelDesc,
		       a.user_total userTotal,
		       ROUND(a.flow/1024/1024, 2) flow,
		       t.fb_type fbFlag
		FROM ST_SIG_USER_EV_label_desc_MM a,
		     dim_ia_product_label b,
		     dim_SIG_LABEL_FB_TYPE t,
		     dim_rd_ia_product_info p
		WHERE a.prod_label_code = b.LABEL_CODE
		  AND a.prod_id = t.prod_id
		  AND a.prod_id = p.PROD_ID
		  <if test="prodLabelCode != null and prodLabelCode != ''">
				AND a.prod_label_code like #{prodLabelCode}
		 </if>
		 <if test="dateId != null and dateId != ''">
		 		AND a.date_id = #{dateId}
		 </if>
		 <if test="fbFlag != '-1' ">
		 		AND t.fb_type = #{fbFlag}
		 </if>
		 AND a.area_id = #{cityId}
		 
		 <choose>
		 	<when test="sidx !=null and sidx != '' and sidx == 'userTotal'">
		 		order by a.user_total
		 	</when>
		 	<otherwise>
		 		order by a.flow
		 	</otherwise>
    	</choose>
    	<choose>
		 	<when test="sord !=null and sord != '' and sord == 'desc'">
		 		desc
		 	</when>
		 	<otherwise>
		 		asc
		 	</otherwise>
    	</choose>
	</select>
	
	<update id="publishById" parameterType="com.bonc.dpi.dao.entity.ProductFbDescInfo">
		update dim_SIG_LABEL_FB_TYPE set fb_type = #{fbFlag} where prod_id = #{prodId}
	</update>
	
	<select id="publishAuth" parameterType="String"  resultType="java.lang.Integer">
		select count(*)
		from dim_sig_publish_UserAuth 
		where user_id = #{loginId}
	</select>

</mapper>